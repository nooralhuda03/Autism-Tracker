{% extends 'base_mother.html' %}
{% block title %}ุชูุงุตูู ุงูุทูู | Mommy Dashboard{% endblock %}

{% block head %}
{{ super() }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="[https://cdn.jsdelivr.net/npm/chart.js](https://cdn.jsdelivr.net/npm/chart.js)"></script>
<style>
  /* ๐จ ุชุทุจูู ุซูู ุงูุจุงุณุชูู ุนูู ุตูุญุฉ ุงูุชูุงุตูู */

  /* ุชุนุฑูู ูุชุบูุฑุงุช ุงูุฃููุงู ูุงุณุชุฎุฏุงููุง ููุง */
  :root {
      --primary-lavender: #8E7DBE; /* ูุงููุฏุฑ */
      --dark-text: #5C4F7D; /* ุจููุณุฌู ุบุงูู */
      --accent-teal: #A6D8D6; /* ุฃุฒุฑู ุณูุงูู */
      --soft-yellow: #F4F8DE; /* ุฃุตูุฑ ูุงุนู */
      --soft-pink: #F7CFD8; /* ูุฑุฏู ูุงุนู */
  }

  .child-header {
    /* ๐ก ุชุทุจูู ุงูุชุฏุฑุฌ ุงูุจุงุณุชููู ุงูููุญุฏ (ูุงููุฏุฑ ูุฃุฒุฑู ุณูุงูู) */
    background: linear-gradient(to right, var(--primary-lavender), var(--accent-teal));
    color: white;
    border-radius: 15px;
    padding: 25px;
    text-align: center;
    margin-bottom: 30px;
    box-shadow: 0 4px 10px rgba(142, 125, 190, 0.4);
  }
  .child-header h3 {
    margin-bottom: 10px;
  }

  /* --- Tabs and Navigation --- */
  .nav-tabs .nav-link.active {
    /* ๐ก ุฎูููุฉ ูุดุทุฉ ูุงุชุญุฉ (ุฃุตูุฑ ุจุงูุช) */
    background-color: var(--soft-yellow) !important;
    color: var(--dark-text) !important; /* ูุต ุจููุณุฌู ุบุงูู */
    font-weight: bold;
    /* ุฎุท ุณููู ุจููู ุงููุงููุฏุฑ ุงูุฃุณุงุณู */
    border-bottom: 3px solid var(--primary-lavender) !important;
    border-color: var(--primary-lavender) var(--primary-lavender) white !important;
  }
  .nav-tabs .nav-link {
    color: var(--dark-text); /* ููู ุงููุต ุบูุฑ ุงููุดุท */
    font-weight: 600;
  }
  .tab-content {
    background: white;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    margin-top: 15px;
  }

  /* --- Form and Inputs (ูุชูููู ุงูููู) --- */
  .form-label {
    color: var(--dark-text);
    font-weight: bold;
  }
  .btn-save {
    /* ๐ก ุฒุฑ ุงูุญูุธ ุจููุณ ุงูุชุฏุฑุฌ ุงูุจุงุณุชููู ุงูููุญุฏ */
    background: linear-gradient(to right, var(--primary-lavender), #A3CCDA);
    border: none;
    color: white;
    font-weight: bold;
    border-radius: 10px;
    padding: 10px 20px;
    transition: all 0.3s;
  }
  .btn-save:hover {
    opacity: 0.9;
    transform: translateY(-1px);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
  }

  /* --- Tables, Charts and Reports --- */
  h5 {
    color: var(--dark-text); /* ููู ุงูุนูุงููู ุงููุฑุนูุฉ */
    font-weight: bold;
  }
  #chart-title, h3 {
    color: var(--dark-text) !important; /* ุชูุญูุฏ ุฃููุงู ุงูุนูุงููู */
  }

  /* ุชุฎุตูุต ุฃููุงู ุงูุฌุฏูู (ุงูุชูููู ุงููููู) */
  .table-bordered {
    border-color: #E0E0E0 !important;
  }
  thead tr th {
    background-color: var(--accent-teal);
    color: var(--dark-text);
    border-color: #A6D8D6 !important;
  }

  /* ุงูุฃููุงู ูู ุงูุฃูุณุงู ุงูุฃุฎุฑู (ุชุญุฏูุซ ุงูุฃููุงู ุงููุฏููุฉ) */
  /* ุงูุฃููุงู ุงููุฏููุฉ ูุงูุช (6a1b9a ู a64ca6 ู d16ba5)ุ ุณูุณุชุจุฏููุง ุจุงูุฃููุงู ุงูุฌุฏูุฏุฉ */
  .tab-pane h3 { color: var(--dark-text) !important; }
  .tab-pane h5 { color: var(--dark-text) !important; }

  /* ุชุฎุตูุต ุฃุฒุฑุงุฑ ุงูููุงุนูุฏ */
  .btn-outline-primary {
    color: var(--primary-lavender);
    border-color: var(--primary-lavender);
  }
  .btn-outline-primary:hover {
    background-color: var(--primary-lavender);
    color: white;
  }
  .save-btn {
            background-color: #8E7DBE; /* ูุงููุฏุฑ - ุงูููู ุงูุฃุณุงุณู */
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s;
            width: 100%;
            margin-top: 30px;
            letter-spacing: 1px;
            box-shadow: 0 4px 10px rgba(142, 125, 190, 0.4);
        }
</style>
{% endblock %}


{% block content %}
<div class="container">
  <div class="child-header">
    <h3>๐งธ {{ child.name }}</h3>
    <p>ุงูุนูุฑ: {{ (date.today().year - child.BD.year) }} ุณูุฉ</p>
  </div>

  <ul class="nav nav-tabs justify-content-center" id="childTabs" role="tablist">
    <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#eval" type="button"> ุงูุชูููู ุงููููู</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#reports" type="button"> ุงูุชูุงุฑูุฑ</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#meds" type="button"> ุงูุฃุฏููุฉ</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#appointments" type="button"> ุงูููุงุนูุฏ</button></li>
  </ul>

  <div class="tab-content">

    <!-- โ ุงูุชูููู ุงููููู -->
    <div class="tab-pane fade show active" id="eval">
      <form method="POST" action="{{ url_for('save_child_rating', child_id=child.child_id) }}">


      <!-- ุงููุญูุฑ 1 -->
      <div class="section-card">
        <h5> ุงููุญูุฑ 1: ุงูุชูุงุตู ูุงูุงูุชุจุงู</h5>
        <table class="table table-bordered align-middle">
          <thead>
            <tr>
              <th>ุงูุณููู</th>
              <th>ุงูุชูููู (1โ5)</th>
              <th>ููุงุญุธุงุช ุจุณูุทุฉ</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>ูุชูุงุตู ุจุงููุธุฑ (Eye Contact)</td>
              <td class="rating">
                <input type="radio" name="eye" value="1">1
                <input type="radio" name="eye" value="2">2
                <input type="radio" name="eye" value="3">3
                <input type="radio" name="eye" value="4">4
                <input type="radio" name="eye" value="5">5
              </td>
              <td><input class="note-input" type="text"></td>
            </tr>
            <tr>
              <td>ูุณุชุฌูุจ ูุงุณูู ุนูุฏ ููุงุฏุงุชู</td>
              <td class="rating">
                <input type="radio" name="name_call" value="1">1
                <input type="radio" name="name_call" value="2">2
                <input type="radio" name="name_call" value="3">3
                <input type="radio" name="name_call" value="4">4
                <input type="radio" name="name_call" value="5">5
              </td>
              <td><input class="note-input" type="text"></td>
            </tr>
            <tr>
              <td>ูุญุงูู ุงูุชุนุจูุฑ ุจุงูููุงู ุฃู ุงูุฅุดุงุฑุฉ</td>
              <td class="rating">
                <input type="radio" name="express" value="1">1
                <input type="radio" name="express" value="2">2
                <input type="radio" name="express" value="3">3
                <input type="radio" name="express" value="4">4
                <input type="radio" name="express" value="5">5
              </td>
              <td><input class="note-input" type="text"></td>
            </tr>
            <tr>
              <td>ูุชุจุน ุงูุชุนูููุงุช ุงูุจุณูุทุฉ</td>
              <td class="rating">
                <input type="radio" name="follow_instr" value="1">1
                <input type="radio" name="follow_instr" value="2">2
                <input type="radio" name="follow_instr" value="3">3
                <input type="radio" name="follow_instr" value="4">4
                <input type="radio" name="follow_instr" value="5">5
              </td>
              <td><input class="note-input" type="text"></td>
            </tr>
            <tr>
              <td>ูุดุงุฑู ูู ุงูุญูุงุฑ ุฃู ูุฑุฏ ุนูู ุงูุฃุณุฆูุฉ</td>
              <td class="rating">
                <input type="radio" name="conversation" value="1">1
                <input type="radio" name="conversation" value="2">2
                <input type="radio" name="conversation" value="3">3
                <input type="radio" name="conversation" value="4">4
                <input type="radio" name="conversation" value="5">5
              </td>
              <td><input class="note-input" type="text"></td>
            </tr>
          </tbody>
        </table>
        <div class="legend">
          1 = ูุงุฏุฑ ุฌุฏูุง / ูู ูุธูุฑุ 2 = ููููุ 3 = ุฃุญูุงููุงุ 4 = ุบุงูุจูุงุ 5 = ุฏุงุฆููุง ุฃู ููุชุงุฒ.
        </div>
      </div>

      <!-- ุงููุญูุฑ 2 -->
      <div class="section-card">
        <h5> ุงููุญูุฑ 2: ุงูุชูุงุนู ุงูุงุฌุชูุงุนู</h5>
        <table class="table table-bordered align-middle">
          <thead>
            <tr>
              <th>ุงูุณููู</th>
              <th>ุงูุชูููู (1โ5)</th>
              <th>ููุงุญุธุงุช</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>ูุชูุงุนู ูุน ุฃูุฑุงุฏ ุงูุนุงุฆูุฉ</td><td class="rating">
              <input type="radio" name="family" value="1">1
              <input type="radio" name="family" value="2">2
              <input type="radio" name="family" value="3">3
              <input type="radio" name="family" value="4">4
              <input type="radio" name="family" value="5">5
            </td><td><input class="note-input" type="text"></td></tr>

            <tr><td>ูุจุงุฏุฑ ุจุงููุนุจ ูุน ุงูุขุฎุฑูู</td><td class="rating">
              <input type="radio" name="play" value="1">1
              <input type="radio" name="play" value="2">2
              <input type="radio" name="play" value="3">3
              <input type="radio" name="play" value="4">4
              <input type="radio" name="play" value="5">5
            </td><td><input class="note-input" type="text"></td></tr>

            <tr><td>ูุธูุฑ ูุดุงุนุฑ (ุถุญูุ ุญูุงุณุ ุนูุงู)</td><td class="rating">
              <input type="radio" name="emotion" value="1">1
              <input type="radio" name="emotion" value="2">2
              <input type="radio" name="emotion" value="3">3
              <input type="radio" name="emotion" value="4">4
              <input type="radio" name="emotion" value="5">5
            </td><td><input class="note-input" type="text"></td></tr>

            <tr><td>ูุชุญูู ุงูุงูุชุธุงุฑ ุฃู ุงููุดุงุฑูุฉ</td><td class="rating">
              <input type="radio" name="patience" value="1">1
              <input type="radio" name="patience" value="2">2
              <input type="radio" name="patience" value="3">3
              <input type="radio" name="patience" value="4">4
              <input type="radio" name="patience" value="5">5
            </td><td><input class="note-input" type="text"></td></tr>

            <tr><td>ููููุฏ ุฃูุนุงู ุงูุขุฎุฑูู</td><td class="rating">
              <input type="radio" name="imitate" value="1">1
              <input type="radio" name="imitate" value="2">2
              <input type="radio" name="imitate" value="3">3
              <input type="radio" name="imitate" value="4">4
              <input type="radio" name="imitate" value="5">5
            </td><td><input class="note-input" type="text"></td></tr>
          </tbody>
        </table>
      </div>

      <!-- ุงููุญูุฑ 3 -->
      <div class="section-card">
        <h5> ุงููุญูุฑ 3: ุงูุณููููุงุช ุงูุชูุฑุงุฑูุฉ ูุงูุชูุธูู ุงูุฐุงุชู</h5>
        <table class="table table-bordered">
          <thead><tr><th>ุงูุณููู</th><th>ุงูุชูููู</th><th>ููุงุญุธุงุช</th></tr></thead>
          <tbody>
            <tr><td>ุญุฑูุงุช ูุชูุฑุฑุฉ (ุฑูุฑูุฉุ ุฏูุฑุงู)</td><td class="rating"><input type="radio" name="repetitive" value="1">1<input type="radio" name="repetitive" value="2">2<input type="radio" name="repetitive" value="3">3<input type="radio" name="repetitive" value="4">4<input type="radio" name="repetitive" value="5">5</td><td><input class="note-input" type="text"></td></tr>
            <tr><td>ุงูุชูุณู ุจุงูุฑูุชูู / ุฑูุถ ุงูุชุบููุฑ</td><td class="rating"><input type="radio" name="routine" value="1">1<input type="radio" name="routine" value="2">2<input type="radio" name="routine" value="3">3<input type="radio" name="routine" value="4">4<input type="radio" name="routine" value="5">5</td><td><input class="note-input" type="text"></td></tr>
            <tr><td>ููุจุงุช ุงูุบุถุจ ุฃู ุงูุจูุงุก</td><td class="rating"><input type="radio" name="anger" value="1">1<input type="radio" name="anger" value="2">2<input type="radio" name="anger" value="3">3<input type="radio" name="anger" value="4">4<input type="radio" name="anger" value="5">5</td><td><input class="note-input" type="text"></td></tr>
            <tr><td>ุงููุฏุฑุฉ ุนูู ุงูุชูุฏุฆุฉ ุจุนุฏ ุงูุงูุฒุนุงุฌ</td><td class="rating"><input type="radio" name="calm" value="1">1<input type="radio" name="calm" value="2">2<input type="radio" name="calm" value="3">3<input type="radio" name="calm" value="4">4<input type="radio" name="calm" value="5">5</td><td><input class="note-input" type="text"></td></tr>
            <tr><td>ุงูุญุณุงุณูุฉ ูู ุงูุฃุตูุงุช ุฃู ุงูุฃุถูุงุก</td><td class="rating"><input type="radio" name="sensitivity" value="1">1<input type="radio" name="sensitivity" value="2">2<input type="radio" name="sensitivity" value="3">3<input type="radio" name="sensitivity" value="4">4<input type="radio" name="sensitivity" value="5">5</td><td><input class="note-input" type="text"></td></tr>
          </tbody>
        </table>
      </div>

      <!-- ุงููุญูุฑ 4 -->
      <div class="section-card">
        <h5> ุงููุญูุฑ 4: ุงูุนุงุฏุงุช ุงูููููุฉ</h5>
        <table class="table table-bordered">
          <thead><tr><th>ุงููุดุงุท</th><th>ุงูุชูููู</th><th>ููุงุญุธุงุช</th></tr></thead>
          <tbody>
            <tr><td>ุชูุงูู ุงูุทุนุงู ุจุฏูู ุฑูุถ</td><td class="rating"><input type="radio" name="eat" value="1">1<input type="radio" name="eat" value="2">2<input type="radio" name="eat" value="3">3<input type="radio" name="eat" value="4">4<input type="radio" name="eat" value="5">5</td><td><input class="note-input" type="text"></td></tr>
            <tr><td>ุงุณุชุฎุฏุงู ุงูุญูุงู ุฃู ุงูุญูุงุธ</td><td class="rating"><input type="radio" name="toilet" value="1">1<input type="radio" name="toilet" value="2">2<input type="radio" name="toilet" value="3">3<input type="radio" name="toilet" value="4">4<input type="radio" name="toilet" value="5">5</td><td><input class="note-input" type="text"></td></tr>
            <tr><td>ุงููุจุณ ุฃู ุงูุชุฑุชูุจ ุจููุณู</td><td class="rating"><input type="radio" name="dress" value="1">1<input type="radio" name="dress" value="2">2<input type="radio" name="dress" value="3">3<input type="radio" name="dress" value="4">4<input type="radio" name="dress" value="5">5</td><td><input class="note-input" type="text"></td></tr>
            <tr><td>ุณุงุนุงุช ุงูููู ูุฌูุฏุชู</td><td class="rating"><input type="radio" name="sleep" value="1">1<input type="radio" name="sleep" value="2">2<input type="radio" name="sleep" value="3">3<input type="radio" name="sleep" value="4">4<input type="radio" name="sleep" value="5">5</td><td><input class="note-input" type="text"></td></tr>
            <tr><td>ุงูุงูุชุฒุงู ุจุงูุฑูุชูู ุงููููู</td><td class="rating"><input type="radio" name="daily" value="1">1<input type="radio" name="daily" value="2">2<input type="radio" name="daily" value="3">3<input type="radio" name="daily" value="4">4<input type="radio" name="daily" value="5">5</td><td><input class="note-input" type="text"></td></tr>
          </tbody>
        </table>
      </div>

      <!-- ุงููุญูุฑ 5 -->
      <div class="section-card">
        <!-- ุงููุญูุฑ 5 -->
<div class="section-card">
  <h5> ุงููุญูุฑ 5: ุงููุดุงุท ูุงูุชุฑููุฒ</h5>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>ุงููุดุงุท</th>
        <th>ุงูุชูููู (1โ5)</th>
        <th>ููุงุญุธุงุช</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>ูุณุชุทูุน ุงูุชุฑููุฒ ุนูู ูููุฉ ูุฃูุซุฑ ูู 5 ุฏูุงุฆู</td>
        <td class="rating">
          <input type="radio" name="focus" value="1">1
          <input type="radio" name="focus" value="2">2
          <input type="radio" name="focus" value="3">3
          <input type="radio" name="focus" value="4">4
          <input type="radio" name="focus" value="5">5
        </td>
        <td><input class="note-input" type="text"></td>
      </tr>
      <tr>
        <td>ูุจุฏู ุงูุชูุงููุง ุจุงูุฃูุนุงุจ ุฃู ุงูุฃูุดุทุฉ ุงูุฌุฏูุฏุฉ</td>
        <td class="rating">
          <input type="radio" name="interest" value="1">1
          <input type="radio" name="interest" value="2">2
          <input type="radio" name="interest" value="3">3
          <input type="radio" name="interest" value="4">4
          <input type="radio" name="interest" value="5">5
        </td>
        <td><input class="note-input" type="text"></td>
      </tr>
      <tr>
        <td>ูููู ุงูููุงู ุฃู ุงูุฃูุดุทุฉ ุงูุชู ุจุฏุฃูุง</td>
        <td class="rating">
          <input type="radio" name="complete" value="1">1
          <input type="radio" name="complete" value="2">2
          <input type="radio" name="complete" value="3">3
          <input type="radio" name="complete" value="4">4
          <input type="radio" name="complete" value="5">5
        </td>
        <td><input class="note-input" type="text"></td>
      </tr>
      <tr>
        <td>ููุชูู ูู ูุดุงุท ูุขุฎุฑ ุจุณูููุฉ</td>
        <td class="rating">
          <input type="radio" name="switch_activity" value="1">1
          <input type="radio" name="switch_activity" value="2">2
          <input type="radio" name="switch_activity" value="3">3
          <input type="radio" name="switch_activity" value="4">4
          <input type="radio" name="switch_activity" value="5">5
        </td>
        <td><input class="note-input" type="text"></td>
      </tr>
      <tr>
        <td>ูุชุนุงูู ุฃุซูุงุก ุงููุดุงุท ุฏูู ุชุดุชูุช</td>
        <td class="rating">
          <input type="radio" name="cooperation" value="1">1
          <input type="radio" name="cooperation" value="2">2
          <input type="radio" name="cooperation" value="3">3
          <input type="radio" name="cooperation" value="4">4
          <input type="radio" name="cooperation" value="5">5
        </td>
        <td><input class="note-input" type="text"></td>
      </tr>
    </tbody>
  </table>
</div>
<!-- ุงููุญูุฑ 6 -->
<div class="section-card">
  <h5> ุงููุญูุฑ 6: ุงูุนุงุทูุฉ ูุงูุณููู ุงูุนุงู</h5>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>ุงูุณููู</th>
        <th>ุงูุชูููู (1โ5)</th>
        <th>ููุงุญุธุงุช</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>ูุจุฏู ุณุนูุฏูุง ุฃู ูุฑุชุงุญูุง ุฃุบูุจ ุงูููุช</td>
        <td class="rating">
          <input type="radio" name="happy" value="1">1
          <input type="radio" name="happy" value="2">2
          <input type="radio" name="happy" value="3">3
          <input type="radio" name="happy" value="4">4
          <input type="radio" name="happy" value="5">5
        </td>
        <td><input class="note-input" type="text"></td>
      </tr>
      <tr>
        <td>ูุชุนุงูู ุจูุฏูุก ูุน ุงูููุงูู ุงูุฌุฏูุฏุฉ</td>
        <td class="rating">
          <input type="radio" name="calm_new" value="1">1
          <input type="radio" name="calm_new" value="2">2
          <input type="radio" name="calm_new" value="3">3
          <input type="radio" name="calm_new" value="4">4
          <input type="radio" name="calm_new" value="5">5
        </td>
        <td><input class="note-input" type="text"></td>
      </tr>
      <tr>
        <td>ููุธูุฑ ูุดุงุนุฑ ุงูุชุนุงุทู ุฃู ุงูุญูุงู</td>
        <td class="rating">
          <input type="radio" name="empathy" value="1">1
          <input type="radio" name="empathy" value="2">2
          <input type="radio" name="empathy" value="3">3
          <input type="radio" name="empathy" value="4">4
          <input type="radio" name="empathy" value="5">5
        </td>
        <td><input class="note-input" type="text"></td>
      </tr>
      <tr>
        <td>ูุนุจูุฑ ุนู ุญุฒูู ุฃู ุงูุฒุนุงุฌู ุจุดูู ููุงุณุจ</td>
        <td class="rating">
          <input type="radio" name="sadness" value="1">1
          <input type="radio" name="sadness" value="2">2
          <input type="radio" name="sadness" value="3">3
          <input type="radio" name="sadness" value="4">4
          <input type="radio" name="sadness" value="5">5
        </td>
        <td><input class="note-input" type="text"></td>
      </tr>
      <tr>
        <td>ูุชูุงุนู ูุน ุงูุชูุฌูู ุฃู ุงูุชุตุญูุญ ุจุดูู ุฅูุฌุงุจู</td>
        <td class="rating">
          <input type="radio" name="response" value="1">1
          <input type="radio" name="response" value="2">2
          <input type="radio" name="response" value="3">3
          <input type="radio" name="response" value="4">4
          <input type="radio" name="response" value="5">5
        </td>
        <td><input class="note-input" type="text"></td>
      </tr>
    </tbody>
  </table>
</div>
<div class="text-center mt-4">
  <button type="submit" class="save-btn"> ุญูุธ ุงูุชูููู</button>
</div>
      </div>
    </form>
    </div>

    <!-- ๐ ุงูุชูุงุฑูุฑ -->


   <div class="tab-pane fade" id="reports">
  <h3 class="text-center mb-5" style="color: #6a1b9a;">  ูุฑูุฒ ุงูุชูุงุฑูุฑ ุงููุชูุงูู</h3>

  <div class="row">
    <!-- ุงูุนููุฏ ุงูุฃูุณุฑ -->
    <div class="col-md-3 d-flex flex-column" style="min-height: 100%;">
      <div class="card shadow-sm mb-4 p-3" style="border-radius: 10px; flex-grow: 1;">
        <h5 style="color: #d16ba5;"><i class="fas fa-filter me-2"></i> ููุน ุงูุชูุฑูุฑ</h5>
        <div class="list-group list-group-flush">
          <a href="#" class="list-group-item list-group-item-action fw-bold active"
            data-type="daily"
            onclick="loadReportList('daily', this); return false;">
            <i class="fas fa-sun me-2"></i> ุชูุงุฑูุฑ ููููุฉ
          </a>
          <a href="#" class="list-group-item list-group-item-action fw-bold"
            data-type="weekly"
            onclick="loadReportList('weekly', this); return false;">
            <i class="fas fa-calendar-week me-2"></i> ุชูุงุฑูุฑ ุฃุณุจูุนูุฉ
          </a>
          <a href="#" class="list-group-item list-group-item-action fw-bold"
            data-type="monthly"
            onclick="loadReportList('monthly', this); return false;">
            <i class="fas fa-calendar-alt me-2"></i> ุชูุงุฑูุฑ ุดูุฑูุฉ
          </a>
        </div>
      </div>

      <h5 class="mt-4" style="color: #d16ba5;"><i class="fas fa-list me-2"></i> ุงูุชูุงุฑูุฑ ุงููุชุงุญุฉ</h5>
      <div class="list-group flex-grow-1" id="report-items-list">
        <div class="p-3 text-muted border rounded">ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ููุน ุชูุฑูุฑ...</div>
      </div>
    </div>

    <!-- ุงูุนููุฏ ุงูุฃููู -->
    <div class="col-md-9 d-flex flex-column">
      <div class="card shadow p-4 rounded flex-grow-1" style="border-radius: 10px; height: 100%;">
        <h4 id="chart-title" style="color: #a64ca6;">ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุชูุฑูุฑ</h4>
        <hr>

        <div id="chart-container" style="position: relative; min-height: 500px; height: 500px;">
          <canvas id="myReportChart"></canvas>
        </div>

        <div id="no-data-message" class="alert alert-warning text-center mt-3" style="display: none;">
          ูุง ุชูุฌุฏ ุจูุงูุงุช ูุชููุฑุฉ ููุฐุง ุงูุชูุฑูุฑ ุฃู ุงููุชุฑุฉ.
        </div>
      </div>
    </div>
  </div>
</div>





    <!-- ๐ ุงูุฃุฏููุฉ -->
   <div class="tab-pane fade" id="meds">
  <div class="mt-4">
    <h5 class="text-center mb-4" style="color:#6a1b9a;"> ุงูุฃุฏููุฉ ุงูุญุงููุฉ</h5>
    {% if medicines %}
      <ul class="list-group">
        {% for med in medicines %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span><strong>{{ med.medicine_name }}</strong> - {{ med.dosage }} ููุบ</span>
            <span class="badge bg-light text-dark">{{ med.time_per_day }} ูุฑุฉ/ููู</span>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="alert alert-info text-center">ูุง ุชูุฌุฏ ุฃุฏููุฉ ุญุงููุงู ููุฐุง ุงูุทูู.</div>
    {% endif %}
  </div>
</div>

    <!-- ๐ ุงูููุงุนูุฏ -->
    <div class="tab-pane fade" id="appointments">
  <div class="mt-4">

    <h5 class="text-center mb-4" style="color:#6a1b9a;"> ุงูููุงุนูุฏ ุงููุงุฏูุฉ (ุงููุญุฌูุฒุฉ)</h5>
    {% if appointments and appointments|length > 0 %}
      <ul class="list-group" id="booked-appointments-list"> <!-- ๐ฏ ุชู ุฅุถุงูุฉ ID -->
        {% for app in appointments %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <!-- ุงูููุฏ ุงูุตุญูุญ ุงูุขู -->
<strong>{{ app.day_of_week }} - {{ app.time }}</strong><br>
              <small class="text-muted">
                ุงูุทุจูุจ: {{ app.doctor.name if app.doctor else 'ุบูุฑ ูุนุฑูู' }}
              </small>
            </div>
            {% if app.status == 'available' %}
              <span class="badge bg-success">ูุชุงุญ</span>
            {% elif app.status == 'booked' %}
              <span class="badge bg-warning text-dark">ูุญุฌูุฒ</span>
            {% elif app.status == 'completed' %}
              <span class="badge bg-secondary">ููุชูู</span>
            {% elif app.status == 'canceled' %}
              <span class="badge bg-danger">ููุบู</span>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="alert alert-light text-center" id="no-booked-appointments-msg">ูุง ุชูุฌุฏ ููุงุนูุฏ ูุญุฌูุฒุฉ ุญุงููุงู.</div> <!-- ๐ฏ ุชู ุฅุถุงูุฉ ID -->
    {% endif %}

    <hr class="my-4">

    <h5 class="text-center mb-4" style="color:#a64ca6;"> ููุงุนูุฏ ูุชุงุญุฉ ููุญุฌุฒ</h5>

    <!-- โ๏ธ ูุฐุง ูู ุงูุนูุตุฑ ุงูุฐู ูุฌุจ ุฃู ูุณุชูุฏูู ุงูู JS ูุฌูุจ ุงูููุงุนูุฏ -->
    <div id="appointments-container">
       <div class="p-3 text-muted text-center">ุฌุงุฑู ุชุญููู ุงูููุงุนูุฏ ุงููุชุงุญุฉ...</div>
    </div>

  </div>
</div>
<!-- ููุงูุฉ ุงูููุงุนูุฏ -->



  </div>
</div>
<script>
let currentChart = null;

    // โ ุฃุฎุฐ child_id ูู Flask ูุจุงุดุฑุฉ
    let currentChildId = {{ child.child_id | tojson if child else 'null' }};
    let currentReportType = 'daily';

    document.addEventListener('DOMContentLoaded', function() {
        console.log("โ Loaded doctor report page for child_id:", currentChildId);

        if (currentChildId) {
            // ุชุญููู ุงูุชูุงุฑูุฑ ุงูููููุฉ ูุจุงุดุฑุฉ
            loadReportList(currentReportType, document.querySelector('[data-type="daily"]'));
        } else {
            document.getElementById('chart-title').textContent = "ูุง ููุฌุฏ ุฃุทูุงู ูุณุฌููู.";
        }
    });

    // ----------------------------------------
    // ุฏุงูุฉ ุฌูุจ ูุงุฆูุฉ ุงูุชูุงุฑูุฑ
    // ----------------------------------------
    function loadReportList(reportType, element) {
        currentReportType = reportType;

        document.querySelectorAll('.list-group-item-action').forEach(el => el.classList.remove('active'));
        element.classList.add('active');

        const listContainer = document.getElementById('report-items-list');
        listContainer.innerHTML = '<div class="p-3 text-center text-info"><i class="fas fa-spinner fa-spin me-2"></i> ุฌุงุฑู ุงูุชุญููู...</div>';

        if (!currentChildId) {
            listContainer.innerHTML = '<div class="p-3 text-muted border rounded">ูุฌุจ ุงุฎุชูุงุฑ ุทูู ุฃููุงู.</div>';
            return;
        }

        // โ ุฌูุจ ุงูุชูุงุฑูุฑ ุงูุฎุงุตุฉ ุจุงูุทูู
        fetch(`/api/report/list/${reportType}?child_id=${currentChildId}`)
            .then(response => response.json())
            .then(data => {
                listContainer.innerHTML = '';
                document.getElementById('chart-title').textContent = data.title;

                if (!data.items || data.items.length === 0) {
                    listContainer.innerHTML = '<div class="p-3 text-muted border rounded">ูุง ุชูุฌุฏ ุชูุงุฑูุฑ ูุณุฌูุฉ ูู ูุฐู ุงููุชุฑุฉ.</div>';
                    if (currentChart) { currentChart.destroy(); currentChart = null; }
                    return;
                }

                data.items.forEach(item => {
                    const link = document.createElement('a');
                    link.href = '#';
                    link.className = 'list-group-item list-group-item-action report-link';
                    link.textContent = item.title;
                    link.onclick = (e) => {
                        e.preventDefault();
                        loadReportChart(reportType, item.id, item.child_id, link);
                    };
                    listContainer.appendChild(link);
                });

                // ุนุฑุถ ุฃูู ุชูุฑูุฑ ุชููุงุฆููุง
                const firstLink = listContainer.querySelector('a');
                if (firstLink) {
                    loadReportChart(reportType, data.items[0].id, data.items[0].child_id, firstLink);
                }
            })
            .catch(error => {
                console.error('โ Error loading report list:', error);
                listContainer.innerHTML = '<div class="p-3 text-danger border rounded">ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุญููู ุงููุงุฆูุฉ.</div>';
            });
    }

    // ----------------------------------------
    // ุฏุงูุฉ ุชุญููู ุจูุงูุงุช ุงูุชูุฑูุฑ ูุนุฑุถูุง ุจุงูุฑุณู ุงูุจูุงูู
    // ----------------------------------------
    function loadReportChart(reportType, reportId, childId, linkElement) {
        document.querySelectorAll('.report-link').forEach(el => el.classList.remove('active-item'));
        linkElement.classList.add('active-item');

        document.getElementById('no-data-message').style.display = 'none';
        document.getElementById('chart-title').textContent = linkElement.textContent;
        document.getElementById('chart-container').style.opacity = '0.5';

        fetch(`/api/report/data/${reportType}/${reportId}/${childId}`)
            .then(response => {
                if (!response.ok) {
                    return response.json().then(data => Promise.reject(data));
                }
                return response.json();
            })
            .then(chartData => {
                document.getElementById('chart-container').style.opacity = '1';
                if (currentChart) currentChart.destroy();

                const ctx = document.getElementById('myReportChart').getContext('2d');
                const chartType = (reportType === 'daily') ? 'bar' : 'line';
                const labelText = (reportType === 'daily') ? 'ูุณุชูู ุงูุฃุฏุงุก (5 = ููุชุงุฒ)' : 'ูุชูุณุท ุงูุชูููู';

                currentChart = new Chart(ctx, {
                    type: chartType,
                    data: {
                        labels: chartData.labels,
                        datasets: [{
                            label: labelText,
                            data: chartData.data,
                            backgroundColor: (chartType === 'bar')
                                ? 'rgba(166, 76, 166, 0.7)'
                                : 'rgba(106, 27, 154, 0.5)',
                            borderColor: 'rgba(106, 27, 154, 1)',
                            borderWidth: 2,
                            tension: (chartType === 'line') ? 0.3 : 0,
                            fill: (chartType === 'line')
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 5.2,
                                title: { display: true, text: 'ุงูุชูููู' }
                            }
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: 'ุชุญููู ุฃุฏุงุก ุงูุทูู: ' + chartData.child_name,
                                font: { size: 16 }
                            }
                        },
                        rtl: true
                    }
                });
            })
            .catch(error => {
                console.error('โ Error loading chart:', error);
                document.getElementById('chart-container').style.opacity = '1';
                document.getElementById('no-data-message').textContent =
                    error.error || "ุชุนุฐุฑ ุฌูุจ ุจูุงูุงุช ุงูุฑุณู ุงูุจูุงูู.";
                document.getElementById('no-data-message').style.display = 'block';
                if (currentChart) { currentChart.destroy(); currentChart = null; }
            });
    }
  document.addEventListener('DOMContentLoaded', () => {
    const ctx = document.getElementById('childReportChart');
    fetch(`/api/child/report/{{ child.child_id }}`)
      .then(res => res.json())
      .then(data => {
        if (!data || data.data.length === 0) {
          document.getElementById('no-data-msg').style.display = 'block';
          return;
        }
        new Chart(ctx, {
          type: 'line',
          data: {
            labels: data.labels,
            datasets: [{
              label: 'ูุณุชูู ุงูุฃุฏุงุก',
              data: data.data,
              borderColor: '#a64ca6',
              backgroundColor: 'rgba(166,76,166,0.2)',
              tension: 0.3
            }]
          },
          options: { responsive: true, maintainAspectRatio: false }
        });
      });
  });
</script>
<script>
    // ๐ก ุชูุญูุฏ ุชุนุฑูู ุงููุชุบูุฑ ููุฑุฉ ูุงุญุฏุฉ ูู ุงูู Global Scope
    const currentChildId = '{{ child.child_id | string if child.child_id is defined and child.child_id is not none else "null" }}';
    let currentChart = null; // ูููุฎุทุทุงุช ุงูุจูุงููุฉ
    let currentReportType = 'daily';
</script>

<!-- 2. ๐ ูุชูุฉ JavaScript ุฎุงุตุฉ ุจุงูููุงุนูุฏ ููุท (ุจุงุณุชุฎุฏุงู fetch) -->
<!--2. ๐ ูุชูุฉ JavaScript ุฎุงุตุฉ ุจุงูููุงุนูุฏ ููุท (ุจุงุณุชุฎุฏุงู fetch)-->
<script>
// ----------------------------------------
// 1. ุฏุงูุฉ ูุนุงูุฌุฉ ุงูุญุฌุฒ (ุชูุฑุณู ุงูุทูุจ ุฅูู Flask)
// ูุฌุจ ุฃู ุชููู ูุฐู ุงูุฏุงูุฉ ููุนุฑูููุฉ ูู ุงููุทุงู ุงูุนุงู ูุชููู ูุชุงุญุฉ
// ----------------------------------------
function handleBooking(appointmentId, childId, buttonElement) {
    if (!appointmentId || !childId) {
        console.error("Error: Appointment or child information is missing.");
        return;
    }

    buttonElement.disabled = true;
    buttonElement.textContent = "ุฌุงุฑู ุงูุญุฌุฒ...";

    // ุญูุธ ุงูุนูุตุฑ ุงูุฃุจ ููููุนุฏ ุงููุชุงุญ ููู ูุญุฐูู ูุงุญูุงู
    const listItemToRemove = buttonElement.closest('.list-group-item');

    fetch('/api/appointment/book', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            appointment_id: appointmentId,
            child_id: childId
        })
    })
    .then(response => {
        if (!response.ok) {
            return response.json().then(data => Promise.reject(data));
        }
        return response.json();
    })
    .then(data => {

        // 1. ๐๏ธ ุงูุฅุฒุงูุฉ ูู ูุงุฆูุฉ ุงููุชุงุญูู (ุงูุฌุฒุก ุงูุณููู) - ูุฐุง ูุนูู ุจุงููุนู
        if (listItemToRemove) {
            listItemToRemove.remove();
        }

        // 2. โจ ุฅูุดุงุก ุนูุตุฑ ุฌุฏูุฏ ููููุนุฏ ุงููุญุฌูุฒ
        const newBookedItem = document.createElement('li');
        newBookedItem.className = 'list-group-item d-flex justify-content-between align-items-center';

        newBookedItem.innerHTML = `
            <div>
                <strong>${data.appointment.day} - ${data.appointment.time}</strong><br>
                <small class="text-muted">
                    ุงูุทุจูุจ: ${data.appointment.doctor_name || 'ุบูุฑ ูุนุฑูู'}
                </small>
            </div>
            <span class="badge bg-warning text-dark">ูุญุฌูุฒ</span>
        `;

        // 3. โ ููุทู ุงูุฅุถุงูุฉ ุฅูู ูุงุฆูุฉ ุงูููุงุนูุฏ ุงููุงุฏูุฉ (ุงูุฌุฒุก ุงูุนููู)

        // ุงุณุชูุฏุงู ุงูุนูุงุตุฑ ุจุงูู ID ุงูุชู ุชู ุงูุชุฃูุฏ ูู ูุฌูุฏูุง ูู HTML ุงูุขู
        let bookedListContainer = document.getElementById('booked-appointments-list');
        const noAppointmentsMsg = document.getElementById('no-booked-appointments-msg');

        if (bookedListContainer) {
            // ุงูุญุงูุฉ ุฃ: ุงููุงุฆูุฉ ููุฌูุฏุฉ (ูุงู ูููุง ููุงุนูุฏ ุณุงุจูุฉ)ุ ููุท ูุถูู ุฅูููุง
            bookedListContainer.appendChild(newBookedItem);
        } else if (noAppointmentsMsg) {
            // ุงูุญุงูุฉ ุจ: ุงููุงุฆูุฉ ุบูุฑ ููุฌูุฏุฉ (ููุท ุฑุณุงูุฉ "ูุง ุชูุฌุฏ ููุงุนูุฏ")

            // 1. ุฅูุดุงุก ุงูู <ul> ุงูุฌุฏูุฏุฉ
            const newUl = document.createElement('ul');
            newUl.className = 'list-group';
            newUl.id = 'booked-appointments-list';
            newUl.appendChild(newBookedItem);

            // 2. ุงุณุชุจุฏุงู ุฑุณุงูุฉ "ูุง ุชูุฌุฏ ููุงุนูุฏ" ุจุงููุงุฆูุฉ ุงูุฌุฏูุฏุฉ
            // โ๏ธ ูุณุชุฎุฏู parentNode.replaceChild ูุงุณุชุจุฏุงู ุงูุนูุตุฑ ุจุงููุงูู
            noAppointmentsMsg.parentNode.replaceChild(newUl, noAppointmentsMsg);

        } else {
             // ุงูุญุงูุฉ ุฌ: ูุดู ุงูุนุซูุฑ ุนูู ุฃู ุนูุตุฑ (ุฎุทุฃ ูู IDs)
             console.error("โ FATAL UI ERROR: Cannot find booked-appointments-list or no-booked-appointments-msg.");
             // ุจูุง ุฃู ุงูุชุญุฏูุซ ุชู ูู DBุ ูุนูุฏ ุชุญููู ุงูุตูุญุฉ ูุญู ุงุญุชูุงุทู ุขูู
             window.location.reload();
        }

        console.log("ุชู ุชุญุฏูุซ ุงููุงุฌูุฉ ุจูุฌุงุญ:", data.message);
    })
    .catch(error => { // ๐ก ูุฐุง ูู ุงูุฌุฒุก ุงูุฐู ูุงู ูุงูุตุงู ูู ุงูุฏุงูุฉ
        console.error("โ Error during booking:", error);

        // ูู ุญุงูุฉ ุงูุฎุทุฃ: ูุนูุฏ ุชูุนูู ุงูุฒุฑ ููุถุน ุฑุณุงูุฉ ุฎุทุฃ
        const errorMessage = error.error || 'ุญุฏุซ ุฎุทุฃ ุบูุฑ ูุนุฑูู.';
        if (listItemToRemove) {
             // ุฅุนุงุฏุฉ ุงูุนูุตุฑ ููุนุฑุถ ูุน ุฑุณุงูุฉ ุฎุทุฃ ูุคูุชุฉ
             listItemToRemove.innerHTML = `<span class="text-danger">โ ูุดู ุงูุญุฌุฒ: ${errorMessage}</span>`;
             // ุฅุนุงุฏุฉ ุชุญููู ุงููุงุฆูุฉ ุงููุชุงุญุฉ ุจุนุฏ ุซูุงูู
             setTimeout(() => window.location.reload(), 3000);
        }
    });
}

// ----------------------------------------


document.addEventListener('DOMContentLoaded', () => {
    // ๐ก ุงุณุชุฎุฏุงู ุงููุชุบูุฑ ุงูููุนุฑููู ูู ุงููุชูุฉ ุงูุฃููู (currentChildId)
    const childId = currentChildId;

    if (childId === 'null' || childId === '') {
        console.error("โ๏ธ Child ID is missing. Cannot fetch appointments.");
        return;
    }

    // ----------------------------------------
    // (ุฃ) ุฌูุจ ุงูููุงุนูุฏ ุงููุชุงุญุฉ (ุงูู Fetch ุงูุฃุตูู)
    // ----------------------------------------
    const fetchUrl = `/api/appointments/available/${childId}`;
    console.log("๐ก Fetch URL (Appointments):", fetchUrl);

    fetch(fetchUrl)
    .then(res => {
      if (!res.ok) throw new Error('Network response was not ok');
      return res.json();
    })
    .then(data => {
      const container = document.getElementById('appointments-container');

      if (!container) return console.error("โ๏ธ ุนูุตุฑ appointments-container ุบูุฑ ููุฌูุฏ ูู ุงูุตูุญุฉ.");
      console.log("๐ฆ ุงูุจูุงูุงุช ุงูุฑุงุฌุนุฉ (ุงูููุงุนูุฏ):", data);

      if (data.items && data.items.length > 0) {
        const list = document.createElement('ul');
        list.className = 'list-group';

        data.items.forEach(item => {
            const li = document.createElement('li');
            li.className = 'list-group-item d-flex justify-content-between align-items-center';

            // 1. ุฅูุดุงุก ุงูุฒุฑ ูุนูุตุฑ DOM
            const bookButton = document.createElement('button');
            bookButton.className = 'btn btn-sm btn-outline-primary book-btn';
            bookButton.textContent = 'ุงุญุฌุฒ';

            // 2. ๐ ุงูุฑุจุท ุงูููุฑู ุจุงูุฏุงูุฉ ุนูุฏ ุงูุฅูุดุงุก
            bookButton.addEventListener('click', (e) => {
                e.preventDefault();
                // ููุฑุฑ ID ุงูููุนุฏ ู ID ุงูุทูู ูุนูุตุฑ ุงูุฒุฑ ููุณู
                handleBooking(item.id, childId, bookButton);
            });

            // ุฅูุดุงุก ุงููุญุชูู ุงููุตู
            const textSpan = document.createElement('span');
            textSpan.innerHTML = `${item.day} - ${item.datetime || 'ุบูุฑ ูุญุฏุฏ'} (${item.doctor_name || 'ุทุจูุจ'})`;


            li.appendChild(textSpan);
            li.appendChild(bookButton); // ุฅุถุงูุฉ ุงูุฒุฑ ุฅูู ุงููุงุฆูุฉ
            list.appendChild(li);
        });

        container.innerHTML = '';
        container.appendChild(list);
      } else {
        container.innerHTML = '<div class="alert alert-light">ูุง ุชูุฌุฏ ููุงุนูุฏ ูุชุงุญุฉ ุญุงููุงู.</div>';
      }
    })
    .catch(err => {
      console.error("โ ุฎุทุฃ ุฃุซูุงุก ุชุญููู ุงูููุงุนูุฏ:", err);
      document.getElementById('appointments-container').innerHTML =
        '<div class="alert alert-danger">ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุญููู ุงูููุงุนูุฏ.</div>';
    });
});
</script>

{% endblock %}
